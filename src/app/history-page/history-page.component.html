<div class="panel panel-default" *ngIf="isHintVisible()">
  <div class="panel-heading">
    <h3>История</h3>
  </div>
  <div class="panel-body">
    <div class="m-b-md">
      <p>Здесь выводится история всех денежных операций по&nbsp;месяцам, начиная с&nbsp;самой поздней.</p>
      <p>Доходы отмечены зелёным цветом, расходы&nbsp;&mdash; красным. Денежные переводы выделены светло-серым. На&nbsp;верхней строке&nbsp;&mdash; приход на&nbsp;целевой счёт, на&nbsp;нижней&nbsp;&mdash; списание с&nbsp;исходного счёта.</p>
      <p>Отредактируйте запись, нажав на&nbsp;иконку <i class="fa fa-pencil"></i>. После сохранения вы&nbsp;вернётесь к&nbsp;обновлённой истории.</p>
      <p>Чтобы удалить запись, дважды кликните по&nbsp;иконке <i class="fa fa-lg fa-close"></i>.</p>
      <p>На&nbsp;этой странице заканчивается наша экскурсия по&nbsp;системе. Вы&nbsp;всегда сможете повторить&nbsp;её, нажав на&nbsp;иконку с&nbsp;вопросительным знаком в&nbsp;главном меню справа.</p>
    </div>

    <div class="button-holder m-b-n-sm">
      <span class="m-l-xs"><button class="btn m-b-sm btn-primary" (click)="close()" [disabled]="isWizardLoading" [ladda]="isWizardCloseLoading">Я освоился, спасибо!</button></span>
    </div>
  </div>
</div>

<div class="text-center">
  <div class="history-navigation" *ngIf="history.length || range || search">
    <datetimerange class="history-navigation__datetimerange"
                   [fromDate]="fromDate"
                   [toDate]="toDate"
                   (fromDateChange)="fromDate = $event; goToRange()"
                   (toDateChange)="toDate = $event; goToRange()"></datetimerange>

    <input [value] = "search" class="form-control form-control--sm history-navigation__search" (change)="search = $event.target.value">
  </div>

  <h5 *ngIf="!history.length">
    <span *ngIf="!range && !search">
    Вы не записали ни одной транзакции. Запишите <a [routerLink]="'/operations/income'">доход</a>, <a [routerLink]="'/operations/expense'">трату</a>
    или <a [routerLink]="'/operations/transfer'">перевод</a>, чтобы увидеть историю платежей.
    </span>
    <span *ngIf="range || search">
      Таких транзакций не найдено. <span *ngIf="!search">Пожалуйста, выберите другой диапазон дат.</span><span *ngIf="search">Попробуйте другой поисковой запрос.</span>
    </span>
  </h5>

  <div *ngIf="history.length" class="history text-left">
    <div class="history__header history__row">
      <div class="history__header-col history__date">Дата</div>
      <div class="history__header-col history__amounts">Сумма</div>
      <div class="history__header-col history__category">Категория (комментарий)</div>
      <div class="history__header-col history__payment-methods">Счёт</div>
    </div>

    <ng-container *ngFor="let record of history; let i = index">
      <div class="history__row history__row-date"
           *ngIf="i == 0 || history[i - 1].createdAtDate !== record.createdAtDate">
        <div class="history__col history__date">
          <span>{{record.createdAtDate}}</span>
        </div>
      </div>

      <div class="history__row"
           [class.highlighted]="record.type === 'transfer'">

        <div class="history__col history__action-confirm" *ngIf="record.isMarkedForRemoval">
          кликните снова
        </div>

        <div class="history__col history__actions">
          <a class="fa fa-pencil fa-lg" [routerLink]="'/operations/' + record.type + '/id/' + record.id"></a><!--
        --><span class="fa fa-close fa-lg"
                 [class.active]="record.isMarkedForRemoval"
                 (click)="removeTransaction(record); $event.stopPropagation();"></span>
        </div>
        <div class="history__col history__date">
          <span>{{record.createdAtFormattedCompact}}</span>
        </div>
        <div class="history__col history__amounts">
        <span class="history__amount"
              *ngFor="let amount of record.amounts"
              [class.history__amount--expense]="amount.value < 0">
          {{amount.paymentMethod.currency.symbol}}{{ (amount.value < 0 ? -amount.value : amount.value) | number:'1.2-2' }}
        </span>
        </div>
        <div class="history__col history__payment-methods"
             [class.history__payment-methods--transfer]="record.type === 'transfer'">
        <span class="history__payment-method" *ngFor="let amount of record.amounts" [innerHTML]="amount.paymentMethod.name | highlight:search"></span>
        </div>
        <div class="history__col history__category">
          <span [innerHTML]="record.category.name| highlight:search"></span>
          <span class="comment" *ngIf="record.comment" [innerHTML]="'(' + (record.comment | highlight:search) + ')'"></span>
        </div>
      </div>
    </ng-container>
  </div>
</div>